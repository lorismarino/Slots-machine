// DÃ©claration of variables
const machines = document.querySelector('.machines'),
	startButton = document.querySelector('.start-button'),
	doubleButton = document.querySelector('.double-button'),
	left = document.querySelector('.wheel > .left'),
	middle = document.querySelector('.wheel > .middle'),
	right = document.querySelector('.wheel > .right'),
	placeCoin = document.querySelector('.place-coin'),
	screenCoins = document.querySelector('.infos .coins .screen'),
	screenWin = document.querySelector('.infos .gains .screen'),
	goal = document.querySelector('.goal'),
	goalBack = goal.querySelector('.back'),
	goalCoin = goal.querySelector('.coin'),
	wheelSound = document.querySelector('.wheel-sound'),
	coinsSound = document.querySelector('.coins-sound'),
	logo = document.querySelector('.useMachine .logo'),
	machineFaces = document.querySelectorAll('.machine-face'),
	userCoins = document.querySelector('.user-coins');

let randomNumberLeft = '',
	randomNumberMiddle = '',
	randomNumberRight = '',
	onWheel = false,
	coinsInGame = 0,
	isDouble = false,
	jackpot = parseInt(localStorage.getItem('jackpot')),
	faces = [];

for (let i = 0; i < 49; i++)
{
	faces.push(0)
}
for (let i = 49; i < 69; i++)
{
	faces.push(45)
}
for (let i = 69; i < 79; i++)
{
	faces.push(90)
}
for (let i = 79; i < 84; i++)
{
	faces.push(135)
}
for (let i = 84; i < 89; i++)
{
	faces.push(180)
}
for (let i = 89; i < 94; i++)
{
	faces.push(225)
}
for (let i = 94; i < 97; i++)
{
	faces.push(270)
}
for (let i = 97; i < 99; i++)
{
	faces.push(315)
}

for (let i = 0; i < 9; i++)
{
	let newCoin = document.createElement('div')
	newCoin.classList.add('coin')
	newCoin.style.marginLeft = Math.floor(Math.random() * 66) + 'px'
	newCoin.style.marginTop = Math.floor(Math.random() * 5) + 'px'
	newCoin.style.transitionDelay = 100 + Math.floor(Math.random() * 1000) + 'ms'
	newCoin.innerHTML = goalCoin.innerHTML
	goalBack.appendChild(newCoin)
}

let goalCoins = document.querySelectorAll('.useMachine .goal .back .coin');

goalBack.removeChild(goalCoins[0])

goalCoins = document.querySelectorAll('.useMachine .goal .back .coin');

startButton.addEventListener('click', () =>
{
	startButton.style.transform = 'translateZ(-5px)'
	startButton.style.cursor = '-webkit-grabbing'
	setTimeout(() =>
	{
		startButton.style.transform = 'translateZ(5px)'
		startButton.style.cursor = '-webkit-grab'
	}, 100)
})

startButton.addEventListener('mousedown', () =>
{
	startButton.style.transform = 'translateZ(-5px)'
	startButton.style.cursor = '-webkit-grabbing'

	if (!onWheel && ((!isDouble && coinsInGame >= 1) || (isDouble && coinsInGame >= 2)))
	{
		wheelSound.currentTime = 1;
		wheelSound.play()

		onWheel = true

		if (!isDouble)
		{
			coinsInGame--
		}
		else
		{
			coinsInGame -= 2
		}

		screenCoins.innerHTML = coinsInGame

		goal.classList.remove('active')

		// Declaration of wheel

		randomNumberLeft = Math.floor(Math.random() * 100)
		randomNumberMiddle = Math.floor(Math.random() * 100)
		randomNumberRight = Math.floor(Math.random() * 100)

		left.style.transition = 'none'
		middle.style.transition = 'none'
		right.style.transition = 'none'
		left.style.transform = 'rotateX(0)'
		middle.style.transform = 'rotateX(0)'
		right.style.transform = 'rotateX(0)'

		setTimeout(() =>
		{
			left.style.transition = 'transform 5s cubic-bezier(0.42, 0, 0.14, 1.5)'
			left.style.transform = `rotateX(-${1080 + faces[randomNumberLeft]}deg)`

			middle.style.transition = 'transform 7s cubic-bezier(0.42, 0, 0.14, 1.5)'
			middle.style.transform = `rotateX(-${1800 + faces[randomNumberMiddle]}deg)`

			right.style.transition = 'transform 6s cubic-bezier(0.42, 0, 0.14, 1.5)'
			right.style.transform = `rotateX(-${1440 + faces[randomNumberRight]}deg)`
		}, 10)


		setTimeout(() =>
		{
			onWheel = false
			wheelSound.pause();
			if (faces[randomNumberLeft] == faces[randomNumberMiddle] && faces[randomNumberLeft] == faces[randomNumberRight])
			{
				logo.classList.add('active')
				goal.classList.add('active')
				coinsSound.play()
				setTimeout(() =>
				{
					coinsSound.pause()
					coinsSound.currentTime = 0
				}, 1000)
				if (faces[randomNumberLeft] == 0)
				{
					if (isDouble)
					{
						for (let i = 0; i < 1; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 2
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 2)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
					else
					{
						goalCoins[0].style.visibility = 'visible'
						screenWin.innerHTML = 1
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 1)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
				}
				else if (faces[randomNumberLeft] == 45)
				{
					if (isDouble)
					{
						for (let i = 0; i < 5; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 6
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 6)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
					else
					{
						for (let i = 0; i < 2; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 3
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 3)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
				}
				else if (faces[randomNumberLeft] == 90)
				{
					if (isDouble)
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 10
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 10)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
					else
					{
						for (let i = 0; i < 4; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 5
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 5)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
				}
				else if (faces[randomNumberLeft] == 135)
				{
					if (isDouble)
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 20
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 20)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
					else
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 10
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 10)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
				}
				else if (faces[randomNumberLeft] == 180)
				{
					if (isDouble)
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 40
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 40)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
					else
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 20
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 20)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
				}
				else if (faces[randomNumberLeft] == 225)
				{
					if (isDouble)
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 100
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 100)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
					else
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 50
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 50)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
				}
				else if (faces[randomNumberLeft] == 270)
				{
					if (isDouble)
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 400
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 400)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
					else
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 200
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 200)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
				}
				else if (faces[randomNumberLeft] == 315)
				{
					if (isDouble)
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 2000
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 2000)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
					else
					{
						for (let i = 0; i < 9; i++)
						{
							goalCoins[i].style.visibility = 'visible'
						}
						screenWin.innerHTML = 1000
						localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + 1000)
						userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
					}
				}
			}
			else if (randomNumberLeft == 0 && randomNumberMiddle == 1 && randomNumberRight == 2)
			{
				if (isDouble)
				{
					for (let i = 0; i < 9; i++)
					{
						goalCoins[i].style.visibility = 'visible'
					}
					screenWin.innerHTML = jackpot * 2
					localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + jackpot * 2)
					userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
				}
				else
				{
					for (let i = 0; i < 9; i++)
					{
						goalCoins[i].style.visibility = 'visible'
					}
					screenWin.innerHTML = jackpot
					localStorage.setItem('coins', parseInt(localStorage.getItem('coins')) + jackpot)
					userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`
				}
				localStorage.setItem('jackpot', 1000)
				jackpot = 1000
			}
			else
			{
				screenWin.innerHTML = '00'
			}

			if (randomNumberLeft != 0 || randomNumberMiddle != 1 || randomNumberRight != 2)
			{
				localStorage.setItem('jackpot', parseInt(localStorage.getItem('jackpot')) + 10)
				jackpot += 10
			}
			isDouble = false
		}, 7000)
	}
})

doubleButton.addEventListener('click', () =>
{
	doubleButton.style.transform = 'translateZ(-5px)'
	doubleButton.style.cursor = '-webkit-grabbing'

	if (!isDouble)
	{
		isDouble = true
	}

	setTimeout(() =>
	{
		doubleButton.style.transform = 'translateZ(5px)'
		doubleButton.style.cursor = '-webkit-grab'
	}, 100)
})

doubleButton.addEventListener('mousedown', () =>
{
	doubleButton.style.transform = 'translateZ(-5px)'
	doubleButton.style.cursor = '-webkit-grabbing'
})

placeCoin.addEventListener('click', () =>
{
	if (localStorage.getItem('coins') >= 1 && coinsInGame < 99)
	{
		placeCoin.classList.remove('active')

		setTimeout(() =>
		{
			placeCoin.classList.add('active')
		}, 10)

		coinsInGame++
		screenCoins.innerHTML = coinsInGame
		localStorage.setItem('coins', localStorage.getItem('coins') - 1)
		userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`

		setTimeout(() =>
		{
			placeCoin.classList.remove('active')
		}, 1000)
	}
})

// Local storage

if (!localStorage.getItem('coins') || localStorage.getItem('coins') == 0)
{
	localStorage.setItem('coins', 10)
}

userCoins.innerHTML = `Vous avez ${localStorage.getItem('coins')} coins`

if (!localStorage.getItem('jackpot'))
{
	localStorage.setItem('jackpot', 1000)
}